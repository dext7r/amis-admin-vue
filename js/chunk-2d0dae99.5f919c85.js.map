{"version":3,"sources":["webpack:///./node_modules/amis/lib/components/RichText.js"],"names":["Object","defineProperty","exports","value","tslib_1","react_1","__importDefault","froala_editor_1","froala_editor_min_js_1","FroalaEditorComponent","_super","props","_this","call","this","listeningEvents","element","editor","config","immediateReactModelUpdate","reactIgnoreAttrs","editorInitialized","INNER_HTML_ATTR","oldModel","__extends","prototype","componentDidMount","createEditor","componentWillUnmount","destroyEditor","componentDidUpdate","JSON","stringify","model","setContent","clone","item","me","result","types","Number","String","Boolean","forEach","type","toString","child","index","array","nodeType","cloneNode","Date","i","__assign","el","innerHTML","registerEvent","events","initialized","initListeners","default","setNormalTagContent","_initEvents","push","self","html","set","undo","reset","saveStep","destroy","length","getEditor","updateModel","onModelChange","modelContent","returnedHtml","get","on","eventName","callback","render","createElement","ref","children","Component","default_1","VIDEO_PROVIDERS","test_regex","url_regex","url_text"],"mappings":"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","file":"js/chunk-2d0dae99.5f919c85.js","sourcesContent":["\"use strict\";\n/**\n * @file RichText\n * @description\n * @author fex\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar react_1 = (0, tslib_1.__importDefault)(require(\"react\"));\n// @ts-ignore\nvar froala_editor_1 = (0, tslib_1.__importDefault)(require(\"froala-editor\"));\n// @ts-ignore\nvar froala_editor_min_js_1 = (0, tslib_1.__importDefault)(require(\"froala-editor/js/froala_editor.min.js\"));\nrequire(\"froala-editor/js/plugins/align.min\");\nrequire(\"froala-editor/js/plugins/colors.min\");\nrequire(\"froala-editor/js/plugins/char_counter.min\");\nrequire(\"froala-editor/js/plugins/code_view.min\");\nrequire(\"froala-editor/js/plugins/draggable.min\");\nrequire(\"froala-editor/js/plugins/entities.min\");\nrequire(\"froala-editor/js/plugins/font_family.min\");\nrequire(\"froala-editor/js/plugins/font_size.min\");\nrequire(\"froala-editor/js/plugins/forms.min\");\nrequire(\"froala-editor/js/plugins/fullscreen.min\");\nrequire(\"froala-editor/js/plugins/help.min\");\nrequire(\"froala-editor/js/plugins/image.min\");\nrequire(\"froala-editor/js/plugins/inline_class.min\");\nrequire(\"froala-editor/js/plugins/inline_style.min\");\nrequire(\"froala-editor/js/plugins/line_breaker.min\");\nrequire(\"froala-editor/js/plugins/line_height.min\");\nrequire(\"froala-editor/js/plugins/link.min\");\nrequire(\"froala-editor/js/plugins/lists.min\");\nrequire(\"froala-editor/js/plugins/paragraph_format.min\");\nrequire(\"froala-editor/js/plugins/paragraph_style.min\");\nrequire(\"froala-editor/js/plugins/print.min\");\nrequire(\"froala-editor/js/plugins/quick_insert.min\");\nrequire(\"froala-editor/js/plugins/quote.min\");\nrequire(\"froala-editor/js/plugins/save.min\");\nrequire(\"froala-editor/js/plugins/special_characters.min\");\nrequire(\"froala-editor/js/plugins/table.min\");\nrequire(\"froala-editor/js/plugins/url.min\");\nrequire(\"froala-editor/js/plugins/video.min\");\nrequire(\"froala-editor/js/plugins/word_paste.min\");\nrequire(\"froala-editor/js/languages/zh_cn.js\");\n// 代码来源于：https://github.com/froala/react-froala-wysiwyg/blob/master/lib/FroalaEditorFunctionality.jsx\n// 改动原因是model 同步有些问题，有时候不更新，所以基于官方代码改造一下。\n// 目前发现的问题是，如果 model 数据修改，如果此时 editor 还没有初始化完成则不会同步成功\nvar FroalaEditorComponent = /** @class */ (function (_super) {\n    (0, tslib_1.__extends)(FroalaEditorComponent, _super);\n    function FroalaEditorComponent(props) {\n        var _this = _super.call(this, props) || this;\n        _this.listeningEvents = [];\n        _this.element = null;\n        _this.editor = null;\n        _this.config = {\n            immediateReactModelUpdate: false,\n            reactIgnoreAttrs: null\n        };\n        _this.editorInitialized = false;\n        _this.INNER_HTML_ATTR = 'innerHTML';\n        _this.oldModel = null;\n        return _this;\n    }\n    // After first time render.\n    FroalaEditorComponent.prototype.componentDidMount = function () {\n        this.createEditor();\n    };\n    FroalaEditorComponent.prototype.componentWillUnmount = function () {\n        this.destroyEditor();\n    };\n    FroalaEditorComponent.prototype.componentDidUpdate = function () {\n        if (JSON.stringify(this.oldModel) == JSON.stringify(this.props.model)) {\n            return;\n        }\n        this.setContent();\n    };\n    // Return cloned object\n    FroalaEditorComponent.prototype.clone = function (item) {\n        var me = this;\n        if (!item) {\n            return item;\n        } // null, undefined values check\n        var types = [Number, String, Boolean], result;\n        // normalizing primitives if someone did new String('aaa'), or new Number('444');\n        types.forEach(function (type) {\n            if (item instanceof type) {\n                result = type(item);\n            }\n        });\n        if (typeof result == 'undefined') {\n            if (Object.prototype.toString.call(item) === '[object Array]') {\n                result = [];\n                item.forEach(function (child, index, array) {\n                    result[index] = me.clone(child);\n                });\n            }\n            else if (typeof item == 'object') {\n                // testing that this is DOM\n                if (item.nodeType && typeof item.cloneNode == 'function') {\n                    result = item.cloneNode(true);\n                }\n                else if (!item.prototype) {\n                    // check that this is a literal\n                    if (item instanceof Date) {\n                        result = new Date(item);\n                    }\n                    else {\n                        // it is an object literal\n                        result = {};\n                        for (var i in item) {\n                            result[i] = me.clone(item[i]);\n                        }\n                    }\n                }\n                else {\n                    if (false && item.constructor) {\n                        result = new item.constructor();\n                    }\n                    else {\n                        result = item;\n                    }\n                }\n            }\n            else {\n                result = item;\n            }\n        }\n        return result;\n    };\n    FroalaEditorComponent.prototype.createEditor = function () {\n        var _this = this;\n        if (this.editorInitialized) {\n            return;\n        }\n        this.config = this.clone(this.props.config || this.config);\n        this.config = (0, tslib_1.__assign)({}, this.config);\n        this.element = this.el;\n        if (this.props.model) {\n            this.element.innerHTML = this.props.model;\n        }\n        this.setContent();\n        // Default initialized.\n        this.registerEvent('initialized', this.config.events && this.config.events.initialized);\n        // Check if events are set.\n        if (!this.config.events)\n            this.config.events = {};\n        this.config.events.initialized = function () {\n            _this.editorInitialized = true;\n            _this.initListeners();\n        };\n        this.editor = new froala_editor_1.default(this.element, this.config);\n    };\n    FroalaEditorComponent.prototype.setContent = function () {\n        var _this = this;\n        if (this.props.model || this.props.model == '') {\n            this.oldModel = this.props.model;\n            if (this.editorInitialized) {\n                this.setNormalTagContent();\n            }\n            else {\n                if (!this._initEvents)\n                    this._initEvents = [];\n                this._initEvents.push(function () { return _this.setNormalTagContent(); });\n            }\n        }\n    };\n    FroalaEditorComponent.prototype.setNormalTagContent = function () {\n        var self = this;\n        self.editor.html && self.editor.html.set(self.props.model || '');\n        if (self.editorInitialized && self.editor.undo) {\n            //This will reset the undo stack everytime the model changes externally. Can we fix this?\n            self.editor.undo.reset();\n            self.editor.undo.saveStep();\n        }\n    };\n    FroalaEditorComponent.prototype.destroyEditor = function () {\n        if (this.element) {\n            this.editor.destroy && this.editor.destroy();\n            this.listeningEvents.length = 0;\n            this.element = null;\n            this.editorInitialized = false;\n            this._initEvents = [];\n        }\n    };\n    FroalaEditorComponent.prototype.getEditor = function () {\n        if (this.element) {\n            return this.editor;\n        }\n        return null;\n    };\n    FroalaEditorComponent.prototype.updateModel = function () {\n        if (!this.props.onModelChange) {\n            return;\n        }\n        var modelContent = '';\n        var returnedHtml = this.editor.html.get();\n        if (typeof returnedHtml === 'string') {\n            modelContent = returnedHtml;\n        }\n        this.oldModel = modelContent;\n        this.props.onModelChange(modelContent);\n    };\n    FroalaEditorComponent.prototype.initListeners = function () {\n        var self = this;\n        // bind contentChange and keyup event to froalaModel\n        this.editor.events.on('contentChanged', function () {\n            self.updateModel();\n        });\n        if (this.config.immediateReactModelUpdate) {\n            this.editor.events.on('keyup', function () {\n                self.updateModel();\n            });\n        }\n        // Call init events.\n        if (this._initEvents) {\n            for (var i = 0; i < this._initEvents.length; i++) {\n                this._initEvents[i].call(this.editor);\n            }\n        }\n    };\n    // register event on jquery editor element\n    FroalaEditorComponent.prototype.registerEvent = function (eventName, callback) {\n        if (!eventName || !callback) {\n            return;\n        }\n        if (eventName == 'initialized') {\n            if (!this._initEvents)\n                this._initEvents = [];\n            this._initEvents.push(callback);\n        }\n        else {\n            if (!this.config.events) {\n                this.config.events = {};\n            }\n            this.config.events[eventName] = callback;\n        }\n    };\n    FroalaEditorComponent.prototype.render = function () {\n        var _this = this;\n        return (react_1.default.createElement(\"textarea\", { ref: function (el) { return (_this.el = el); } }, this.props.children));\n    };\n    return FroalaEditorComponent;\n}(react_1.default.Component));\nvar default_1 = /** @class */ (function (_super) {\n    (0, tslib_1.__extends)(default_1, _super);\n    function default_1(props) {\n        var _this = _super.call(this, props) || this;\n        froala_editor_min_js_1.default.VIDEO_PROVIDERS = [\n            {\n                test_regex: /.*/,\n                url_regex: '',\n                url_text: '',\n                html: '<span class=\"fr-video fr-dvb fr-draggable\" contenteditable=\"false\" draggable=\"true\"><video class=\"fr-draggable\" controls=\"\" data-msg=\"ok\" data-status=\"0\" src=\"{url}\" style=\"width: 600px;\"></video></span>'\n            }\n        ];\n        return _this;\n    }\n    default_1.prototype.render = function () {\n        return (react_1.default.createElement(FroalaEditorComponent, { config: this.props.config, model: this.props.model, onModelChange: this.props.onModelChange }));\n    };\n    return default_1;\n}(react_1.default.Component));\nexports.default = default_1;\n//# sourceMappingURL=./components/RichText.js.map\n"],"sourceRoot":""}